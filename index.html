<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MyTakaful Insurance Dashboard</title>

  <!-- Poppins + FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root{
      --primary:#007F5F;
      --deep-green:#004d40;
      --bg:#f5f7f8;
      --text:#102422;
      --card-shadow:0 4px 12px rgba(3,26,22,0.08);
      --muted:#586e66;
      --success:#2ecc71;
      --error:#e74c3c;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family: 'Poppins', system-ui, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.6;
      padding:20px;
      min-height:100vh;
    }

    .container{
      max-width:1000px;
      margin:0 auto;
      background:white;
      border-radius:15px;
      box-shadow:var(--card-shadow);
      overflow:hidden;
    }

    header{
      background:white; /* requested: white */
      padding:25px;
      text-align:center;
      border-bottom:1px solid #eee;
    }

    .logo{max-width:200px;margin:0 auto 15px;display:block}
    header h3{
      font-size:28px;
      margin-bottom:8px;
      color:var(--deep-green); /* requested deep green */
      font-weight:700;
    }
    header p{ color: rgba(0,0,0,0.8); /* requested 80% black */ font-size:15px }

    .login-container{
      padding:30px;
      max-width:540px;
      margin:0 auto;
    }

    .form-group{ margin-bottom:18px; position:relative }
    .form-group label{ display:block; margin-bottom:8px; font-weight:600; color:var(--deep-green) }

    .input-with-icon{ position:relative }
    .input-with-icon i{
      position:absolute; left:12px; top:50%; transform:translateY(-50%); color:#777; font-size:16px;
      pointer-events:none;
    }
    .input-with-icon input{
      width:100%;
      padding:13px 16px 13px 42px;
      border:1px solid #ddd;
      border-radius:8px;
      font-size:16px;
    }
    .input-with-icon input:focus{ outline:none; border-color:var(--primary); box-shadow:0 0 0 3px rgba(0,127,95,0.08) }

    .btn{
      background:var(--primary);
      color:white;
      border:none;
      padding:13px 18px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
      transition:all 0.25s ease;
      display:inline-block;
      width:100%;
      font-size:16px;
    }
    .btn:hover{ transform:translateY(-2px); background:#00664d }

    .message{ padding:12px; border-radius:8px; margin-bottom:14px; display:none }
    .message.error{ background:#f8d7da; color:var(--error); display:block }
    .message.success{ background:#eafaf0; color:var(--success); display:block }

    /* dashboard */
    #dashboardContainer{ display:none; padding:25px; }
    .user-info{ display:flex; align-items:center; margin-bottom:20px; padding-bottom:18px; border-bottom:1px solid #eee }
    .avatar{
      width:70px;height:70px;border-radius:50%;
      background:linear-gradient(180deg,#eaf7f0,#fff);
      display:flex;align-items:center;justify-content:center;
      font-weight:700;font-size:22px;color:var(--primary);margin-right:18px;
      box-shadow:0 4px 8px rgba(0,0,0,0.08);
    }
    .info-grid{ display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:25px }

    .card{ background:white;border-radius:12px;padding:20px; box-shadow:var(--card-shadow); margin-bottom:18px }
    .info-label{ font-weight:600; color:var(--deep-green); display:block; margin-bottom:6px; font-size:14px }
    .info-value{ color: #586e66 }

    .tracking-box{ background:#eaf7f0; padding:16px; border-radius:10px; text-align:center }
    .tracking-link{ display:inline-block; background:var(--primary); color:white; padding:10px 18px; border-radius:8px; text-decoration:none; font-weight:600; margin-top:8px }

    .status{ display:inline-block; padding:6px 12px; border-radius:20px; font-weight:600; font-size:12px }
    .status.overdue{ background:rgba(231,76,60,0.08); color:var(--error) }
    .status.incoming{ background:rgba(52,152,219,0.08); color:#3498db }

    footer{ text-align:center; padding:18px; background:var(--bg); color:var(--muted); font-size:13px; margin-top:20px }

    .logout-btn{ background:#e74c3c; margin-left:auto; padding:10px 18px; font-size:14px; width:auto; border-radius:8px }
    .logout-btn:hover{ background:#c0392b }

    /* Loading overlay */
    .loading-overlay{
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:white; display:flex; flex-direction:column; justify-content:center; align-items:center;
      z-index:1000; display:none;
    }
    .spinner{
      width:64px;height:64px;border:6px solid rgba(0,127,95,0.18); border-radius:50%;
      border-top:6px solid var(--primary); animation:spin 1s linear infinite; margin-bottom:18px;
    }
    @keyframes spin{ 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
    .loading-text{ font-size:18px; color:var(--primary); font-weight:600 }

    /* fade-in effect */
    .fade-in{ opacity:0; transform:translateY(10px); transition:opacity 0.5s ease, transform 0.5s ease }
    .fade-in.show{ opacity:1; transform:translateY(0) }

    /* Refund modal overlay + blur */
    .modal-overlay{
      position:fixed; inset:0; background:rgba(0,0,0,0.45); backdrop-filter:blur(4px);
      display:flex; align-items:center; justify-content:center; z-index:1100; opacity:0; pointer-events:none; transition:opacity .25s ease;
    }
    .modal-overlay.show{ opacity:1; pointer-events:all }

    .modal{
      width:100%; max-width:720px; background:white; border-radius:12px; padding:20px; box-shadow:0 30px 60px rgba(0,0,0,0.12)
    }
    .modal .modal-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:12px }
    .modal .modal-title{ font-size:18px; font-weight:700; color:var(--deep-green) }
    .modal .close-btn{ background:transparent; border:none; font-size:18px; cursor:pointer; color:#777 }

    /* Refund form layout */
    .refund-form .form-row{ display:flex; gap:12px; margin-bottom:12px }
    .refund-form .form-row .form-group{ flex:1 }
    textarea{ width:100%; padding:12px; border-radius:8px; border:1px solid #ddd; min-height:110px; resize:vertical }
    input[type="file"]{ padding:6px 0 }

    /* responsive */
    @media (max-width:768px){
      .info-grid{ grid-template-columns:1fr }
      .form-row{ flex-direction:column }
      .user-info{ flex-direction:column; text-align:center }
      .avatar{ margin-right:0; margin-bottom:12px }
      .logout-btn{ margin-top:12px; width:100% }
      .login-container{ padding:20px }
    }
  </style>
</head>
<body>
  <div class="container" role="main">
    <header>
      <!-- Logo SVG (kept from your original) -->
      <svg class="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 380.65 58.7" aria-hidden="true">
        <?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 380.65 58.7">
  <defs>
    <style>.cls-1{fill:#8bc53f;}.cls-2{fill:#009345;}</style>
  </defs>
  <g id="Layer_2" data-name="Layer 2">
    <g id="Layer_1-2" data-name="Layer 1">
      <path class="cls-1" d="M225.33,19.31v4.48c1.22-3,4.18-4.95,8.19-4.95,4.53,0,7,2.45,7.66,4.72,1.53-3.26,4.85-4.72,8.16-4.72a8.45,8.45,0,0,1,7.15,3.49c1,1.56.82,3.68.82,5.27v15h-3.62V28c0-2,.4-6.84-5.48-6.84-6.93,0-6.76,8.39-6.76,10.7V42.59h-3.62V28c0-2.22.09-6.84-5.41-6.84-6.62,0-6.84,7.16-6.84,10.7V42.59H222V19.31Z"></path>
      <path class="cls-1" d="M277.18,42.59l-.3-4.43a9.56,9.56,0,0,1-8.46,4.9c-4.83,0-7.62-2.92-7.62-6.12,0-6,9.28-7.59,15.82-9.95v-.84c0-3.82-2.62-5.18-6-5.18a15.09,15.09,0,0,0-7.33,2.11l-.82-2a17.54,17.54,0,0,1,8.67-2.27c3.4,0,7,1,8.32,3.45a8.06,8.06,0,0,1,.79,4.38v7.44c0,5,.21,6.55.7,8.48Zm-12.32-5.93c0,2.68,2.35,4.1,4.79,4.1a6.64,6.64,0,0,0,5.45-2.88c1.34-2,1.52-4.53,1.52-7.59V29c-6.62,2.31-11.76,3.49-11.76,7.59Z"></path>
      <rect class="cls-1" x="284.73" y="8.43" width="3.62" height="34.16"></rect>
      <path class="cls-1" d="M307.51,42.59l-.3-4.43a9.54,9.54,0,0,1-8.45,4.9c-4.83,0-7.62-2.92-7.62-6.12,0-6,9.28-7.59,15.81-9.95v-.84c0-3.82-2.61-5.18-6-5.18a15.09,15.09,0,0,0-7.32,2.11l-.83-2a17.56,17.56,0,0,1,8.66-2.27c3.42,0,7,1,8.33,3.45a8.06,8.06,0,0,1,.79,4.38v7.44c0,5,.21,6.55.7,8.48Zm-12.32-5.93c0,2.68,2.35,4.1,4.79,4.1a6.64,6.64,0,0,0,5.45-2.88c1.35-2,1.52-4.53,1.52-7.59V29c-6.63,2.31-11.76,3.49-11.76,7.59Z"></path>
      <path class="cls-1" d="M316.33,19.31l7.84,18.62,7.14-18.62h2.8L321,51.16h-3.57a36.9,36.9,0,0,0,5.15-8.57L312.19,19.31Z"></path>
      <path class="cls-1" d="M348.88,22a16.3,16.3,0,0,0-5.49-1c-1.09,0-4.79.23-4.79,3,0,1.41.91,2.26,4.39,4.24l.83.47c5.85,3.3,7.19,5.09,7.19,7.72,0,4.35-4.09,6.65-8.79,6.65a15.36,15.36,0,0,1-7.11-1.74l.87-2a13.27,13.27,0,0,0,6.1,1.6c3.22,0,5.44-1.42,5.44-3.72,0-2.12-2.08-3.16-5.1-4.95l-.77-.47c-3.58-2.11-6.54-3.72-6.54-7.07s3.53-5.89,8.45-5.89a16.76,16.76,0,0,1,6,1.18Z"></path>
      <rect class="cls-1" x="354.11" y="19.31" width="3.62" height="23.28"></rect>
      <path class="cls-1" d="M376.89,42.59l-.3-4.43a9.54,9.54,0,0,1-8.45,4.9c-4.84,0-7.62-2.92-7.62-6.12,0-6,9.28-7.59,15.81-9.95v-.84c0-3.82-2.61-5.18-6-5.18A15.09,15.09,0,0,0,363,23.08l-.82-2a17.51,17.51,0,0,1,8.66-2.27c3.41,0,7,1,8.33,3.45a8.15,8.15,0,0,1,.78,4.38v7.44c0,5,.22,6.55.7,8.48Zm-12.33-5.93c0,2.68,2.37,4.1,4.8,4.1a6.62,6.62,0,0,0,5.45-2.88c1.35-2,1.52-4.53,1.52-7.59V29c-6.62,2.31-11.77,3.49-11.77,7.59Z"></path>
      <polygon class="cls-2" points="93.37 19.27 93.37 21.49 85.57 21.49 85.57 42.59 81.06 42.59 81.06 21.49 73.26 21.49 73.26 19.27 93.37 19.27"></polygon>
      <path class="cls-2" d="M109.61,42.59l-.36-4.16a8.41,8.41,0,0,1-7.6,4.63c-4.52,0-6.92-3.13-6.92-6.18,0-5.28,6.44-7.15,14.22-9.82v-.72c0-3.38-2-4.81-5.25-4.81a13.53,13.53,0,0,0-6.45,1.89l-1.07-2.36a18.39,18.39,0,0,1,8.41-2.22c2.29,0,6.5.59,8.13,3.48.69,1.24.76,2.35.76,4.57v7.2a38.39,38.39,0,0,0,.68,8.5ZM99.42,36.46a3.74,3.74,0,0,0,3.93,3.82,5,5,0,0,0,4.43-2.77c1-1.87,1.17-3.94,1.17-6.87V29.38c-6.43,2.38-9.53,3.74-9.53,7Z"></path>
      <polygon class="cls-2" points="138.19 42.59 124.9 29.64 137.55 19.27 133.65 19.27 121.06 30.05 121.06 19.27 116.55 19.27 116.55 42.59 121.06 42.59 121.06 31.37 132.15 42.59 138.19 42.59"></polygon>
      <path class="cls-2" d="M153.21,42.59l-.36-4.16a8.41,8.41,0,0,1-7.6,4.63c-4.52,0-6.93-3.13-6.93-6.18,0-5.28,6.45-7.15,14.23-9.82v-.72c0-3.38-2-4.81-5.25-4.81a13.49,13.49,0,0,0-6.45,1.89l-1.08-2.36a18.47,18.47,0,0,1,8.42-2.22c2.29,0,6.5.59,8.13,3.48.69,1.24.76,2.35.76,4.57v7.2a38.39,38.39,0,0,0,.68,8.5ZM143,36.46A3.73,3.73,0,0,0,147,40.28a5,5,0,0,0,4.43-2.77c1-1.87,1.17-3.94,1.17-6.87V29.38c-6.44,2.38-9.53,3.74-9.53,7Z"></path>
      <polygon class="cls-2" points="176.12 19.27 176.12 21.52 164.71 21.52 164.71 29.97 175.44 29.97 175.44 32.23 164.71 32.23 164.71 42.59 160.19 42.59 160.19 19.27 176.12 19.27"></polygon>
      <path class="cls-2" d="M183.55,19.27V32.84c0,2.71.12,4.3,1.12,5.51,1.54,2,4.11,2.32,5.63,2.32,1.37,0,4.92-.33,6.2-3.28a11.45,11.45,0,0,0,.63-4.61V19.27h2.77V33.42c0,1.22.63,9.52-10.32,9.52-3.18,0-7.67-.92-9.51-4.35-.49-.92-1-2-1-5.15V19.27Z"></path>
      <polygon class="cls-2" points="207.3 19.27 207.3 40.24 218.51 40.24 218.51 42.59 202.78 42.59 202.78 19.27 207.3 19.27"></polygon>
      <polygon class="cls-1" points="355.89 7.54 358.6 10.46 355.89 13.38 353.23 10.46 355.89 7.54"></polygon>
      <path class="cls-1" d="M22.65,7.82,27,3.52,27.49,3l-1.9-1.9A3.67,3.67,0,0,0,23,0H9.66V7.22c2.44-.58,8.07-1.52,13,.6"></path>
      <path class="cls-1" d="M7.82,36.05h0L6,34.26,3,31.21l-1.91,1.9A3.67,3.67,0,0,0,0,35.7V49H7.22c-.58-2.44-1.53-8.07.6-13"></path>
      <path class="cls-1" d="M50.88,22.65l4.84,4.84,1.91-1.9A3.69,3.69,0,0,0,58.71,23V9.66H51.49c.57,2.44,1.52,8.08-.61,13"></path>
      <path class="cls-1" d="M36.05,50.88h0l-4.84,4.84,1.9,1.91A3.66,3.66,0,0,0,35.7,58.7H49V51.48c-2.45.58-8.07,1.53-13-.6"></path>
      <path class="cls-1" d="M39.86,39.86H33.7l-4.35,4.35L22.66,50.9c-4.91,2.12-10.55,1.17-13,.58V58.7H23a3.66,3.66,0,0,0,2.59-1.07l9-9L47.18,36l-4.83-4.83-2.49,2.5Z"></path>
      <path class="cls-1" d="M18.85,39.86V33.71l-4-4-.37-.38L7.81,22.67c-2.13-4.92-1.18-10.56-.59-13H0V23a3.64,3.64,0,0,0,1.07,2.59l9,9L22.66,47.19l4.83-4.84L25,39.86Z"></path>
      <path class="cls-1" d="M18.85,18.85H25l4.35-4.36h0L36,7.81C41,5.68,46.59,6.63,49,7.22V0H35.7a3.67,3.67,0,0,0-2.59,1.08L24.16,10,11.52,22.67l4.83,4.83,2.5-2.5Z"></path>
      <path class="cls-1" d="M57.63,33.11l-1.91-1.9-1.53-1.53-5.51-5.51L36,11.52l-4.82,4.83,2.49,2.5h6.16V25l4.35,4.36L50.9,36C53,41,52.07,46.6,51.49,49H58.7V35.7a3.67,3.67,0,0,0-1.07-2.59"></path>
      <path class="cls-2" d="M9.66,9.66h0c-1.74,6.32-.22,10.45,0,11.15L20.79,9.68c-.69-.22-4.82-1.76-11.13,0"></path>
      <path class="cls-2" d="M37.9,9.67,49,20.8c.22-.7,1.76-4.82,0-11.14-6.31-1.74-10.45-.22-11.14,0"></path>
      <path class="cls-2" d="M9.66,49c6.31,1.74,10.45.23,11.14,0L9.68,37.91c-.22.7-1.76,4.82,0,11.13"></path>
      <path class="cls-2" d="M49,49h0c1.74-6.31.22-10.45,0-11.14L37.91,49c.7.22,4.82,1.75,11.13,0"></path>
      <polygon class="cls-2" points="37.22 32.62 40.49 29.35 37.22 26.09 37.22 21.48 32.61 21.48 29.35 18.21 26.09 21.48 21.48 21.48 21.48 26.09 18.21 29.35 21.48 32.62 21.48 37.23 26.09 37.23 29.35 40.49 32.61 37.23 37.22 37.22 37.22 32.62"></polygon>
    </g>
  </g>
    <rect width="100%" height="100%" fill="transparent"></rect>
      </svg>

      <h3>MyTakaful Refund Portal</h3>
      <p>Access your policy information and track your claims</p>
    </header>

    <!-- LOGIN -->
    <div id="loginArea">
      <div class="login-container" id="loginContainer">
        <div class="message" id="loginMessage" aria-live="polite"></div>

        <form id="loginForm" autocomplete="off" novalidate>
          <div class="form-group">
            <label for="policyNumber">Policy Number</label>
            <div class="input-with-icon">
              <i class="fas fa-id-card-alt" aria-hidden="true"></i>
              <input type="text" id="policyNumber" placeholder="Enter your policy number (e.g. POL-SHZ-02526448)" required>
            </div>
          </div>

          <div class="form-group">
            <label for="password">Password</label>
            <div class="input-with-icon">
              <i class="fas fa-lock" aria-hidden="true"></i>
              <input type="password" id="password" placeholder="Enter your password" required>
            </div>
          </div>

          <button type="submit" class="btn" id="loginBtn"><i class="fas fa-sign-in-alt" style="margin-right:8px"></i>Login</button>
        </form>
      </div>

      <footer aria-label="site footer">
        <p>© Syarikat Takaful Malaysia Keluarga Berhad 198401019089 (131646-K) |
           Syarikat Takaful Malaysia Am Berhad 201701032316 (1246486-D)</p>
        <p>Licensed under the Islamic Financial Services Act 2013 • Regulated by Bank Negara Malaysia • Member of PIDM</p>
      </footer>
    </div>

    <!-- DASHBOARD (hidden initially) -->
    <div id="dashboardContainer" class="fade-in" aria-hidden="true">
      <div class="user-info">
        <div class="avatar" id="userAvatar">US</div>
        <div style="flex:1">
          <h2 id="userName">User Name</h2>
          <p id="userPolicy">Policy Number: Loading...</p>
        </div>
        <div style="display:flex; gap:12px; align-items:center;">
          <button class="btn logout-btn" id="logoutBtn"><i class="fas fa-sign-out-alt" style="margin-right:8px"></i>Logout</button>
        </div>
      </div>

      <div class="info-grid">
        <div class="card">
          <h3>Policy Information</h3>
          <div class="info-item">
            <span class="info-label">Claim ID</span>
            <span class="info-value" id="infoClaim">Loading...</span>
          </div>
          <div class="info-item">
            <span class="info-label">Policy Effective Date</span>
            <span class="info-value" id="infoEffective">Loading...</span>
          </div>
          <div class="info-item">
            <span class="info-label">Coverage Type</span>
            <span class="info-value" id="infoCoverage">Loading...</span>
          </div>
          <div class="info-item">
            <span class="info-label">Coverage Limit</span>
            <span class="info-value" id="infoLimit">Loading...</span>
          </div>
        </div>

        <div class="card">
          <h3>Financial Information</h3>
          <div class="info-item">
            <span class="info-label">Outstanding Premium</span>
            <span class="info-value"><span class="status overdue" id="infoPremium">Loading...</span></span>
          </div>
          <div class="info-item">
            <span class="info-label">Pending Refund</span>
            <span class="info-value"><span class="status incoming" id="infoRefund">Loading...</span></span>
          </div>
          <div class="info-item">
            <span class="info-label">Insured Item</span>
            <span class="info-value" id="infoItem">Loading...</span>
          </div>
          <div class="info-item">
            <span class="info-label">Logistics Provider</span>
            <span class="info-value" id="infoLogistics">Loading...</span>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>Tracking Information</h3>
        <div class="info-item">
          <span class="info-label">Tracking Number</span>
          <span class="info-value" id="infoTracking">Loading...</span>
        </div>

        <div class="tracking-box">
          <p>Track your device shipment status</p>
          <a href="https://idevice-claimtracker.netlify.app" class="tracking-link" target="_blank" id="trackingLink">
            <i class="fas fa-shipping-fast"></i> Track Your Device
          </a>
        </div>
      </div>

      <div class="card">
        <h3>Request a Refund</h3>
        <p>To request a refund, click the button below. We'll ask for a reason and ID document.</p>
        <div style="display:flex; gap:12px; margin-top:12px">
          <button class="btn" id="openRefundBtn"><i class="fas fa-file-invoice-dollar" style="margin-right:8px"></i>Request Refund</button>
        </div>
      </div>

      <footer aria-label="dashboard footer">
        <p>© Syarikat Takaful Malaysia Keluarga Berhad 198401019089 (131646-K)
           Syarikat Takaful Malaysia Am Berhad 201701032316 (1246486-D).</p>
        <p>Licensed under the Islamic Financial Services Act 2013 and regulated by Bank Negara Malaysia. Member of PIDM.</p>
      </footer>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay" aria-hidden="true" role="status" aria-live="polite">
    <div class="spinner" aria-hidden="true"></div>
    <div class="loading-text">Loading your dashboard...</div>
  </div>

  <!-- Refund Modal (hidden) -->
  <div class="modal-overlay" id="refundModalOverlay" aria-hidden="true">
    <div class="modal fade-in" role="dialog" aria-modal="true" aria-labelledby="refundTitle">
      <div class="modal-header">
        <div class="modal-title" id="refundTitle"><i class="fas fa-file-invoice-dollar" style="margin-right:8px"></i>Request a Refund</div>
        <button class="close-btn" id="closeRefundBtn" aria-label="Close refund form">&times;</button>
      </div>

      <form id="refundForm" class="refund-form" enctype="multipart/form-data" novalidate>
        <div class="form-row">
          <div class="form-group">
            <label for="refundName">Full Name</label>
            <input type="text" id="refundName" readonly>
          </div>
          <div class="form-group">
            <label for="refundPolicy">Policy Number</label>
            <input type="text" id="refundPolicy" readonly>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="refundEmail">Email Address</label>
            <input type="email" id="refundEmail" placeholder="you@example.com" required>
          </div>
          <div class="form-group">
            <label for="refundPhone">Phone Number</label>
            <input type="tel" id="refundPhone" placeholder="+60 12-345 6789" required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="refundAmount">Refund Amount (RM)</label>
            <input type="number" id="refundAmount" min="1" placeholder="e.g. 150" required>
          </div>
          <div class="form-group">
            <label for="refundDocuments">Upload IC / ID Document</label>
            <input type="file" id="refundDocuments" accept="image/*,application/pdf" required>
          </div>
        </div>

        <div class="form-group">
          <label for="refundReason">Reason for Refund Request</label>
          <textarea id="refundReason" required placeholder="Please explain why you're requesting a refund..."></textarea>
        </div>

        <div style="display:flex; gap:10px; align-items:center; margin-top:10px">
          <button type="submit" class="btn" id="refundSubmitBtn"><i class="fas fa-paper-plane" style="margin-right:8px"></i>Submit Refund Request</button>
          <button type="button" class="btn" id="cancelRefundBtn" style="background:#ddd; color:#333; width:auto; padding:10px 14px">Cancel</button>
        </div>

        <div class="message" id="refundMessage" role="status" aria-live="polite" style="margin-top:12px"></div>
      </form>
    </div>
  </div>

  <!-- Embedded user-data JSON (also attempted to fetch user-data.json file) -->
  <script>
    // Embedded fallback user-data as a JSON object (keeps your sensitive sample data local)
    const EMBEDDED_USER_DATA = {
      "POL-SHZ-02526448": {
        "name": "ANIS SYUHADA",
        "password": "user123",
        "policy": "POL-SHZ-02526448",
        "claim": "CLM-02526448",
        "effective": "2024-02-12",
        "coverage": "Comprehensive Mobile Device Protection",
        "limit": "12000",
        "premium": "350",
        "refund": "250",
        "item": "Apple iPhone 14 Pro Max",
        "logistics": "J&T Express",
        "tracking": "JT123456789MY"
      },
      "POL-SHZ-02526449": {
        "name": "AHMAD BIN ISMAIL",
        "password": "user456",
        "policy": "POL-SHZ-02526449",
        "claim": "CLM-02526449",
        "effective": "2024-03-15",
        "coverage": "Basic Mobile Device Protection",
        "limit": "8000",
        "premium": "200",
        "refund": "150",
        "item": "Samsung Galaxy S23",
        "logistics": "Pos Malaysia",
        "tracking": "PM123456789MY"
      }
    };
  </script>

  <script>
    // Attempt to fetch an external user-data.json, fallback to EMBEDDED_USER_DATA
    async function loadUserData() {
      try {
        const resp = await fetch('user-data.json', {cache: "no-store"});
        if (!resp.ok) throw new Error('No external JSON');
        const parsed = await resp.json();
        // If the JSON has a top-level "users" property, use it; otherwise expect direct mapping
        if (parsed.users) return parsed.users;
        return parsed;
      } catch (err) {
        console.warn('Using embedded user data fallback:', err.message);
        return EMBEDDED_USER_DATA;
      }
    }

    // DOM elements
    const loginContainer = document.getElementById('loginContainer');
    const loginForm = document.getElementById('loginForm');
    const loginMessage = document.getElementById('loginMessage');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const dashboardContainer = document.getElementById('dashboardContainer');
    const logoutBtn = document.getElementById('logoutBtn');
    const refundModalOverlay = document.getElementById('refundModalOverlay');
    const refundForm = document.getElementById('refundForm');
    const refundMessage = document.getElementById('refundMessage');
    const openRefundBtn = document.getElementById('openRefundBtn');
    const closeRefundBtn = document.getElementById('closeRefundBtn');
    const cancelRefundBtn = document.getElementById('cancelRefundBtn');

    let USERS = {};
    let currentUserKey = null;

    // Initialize on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', async () => {
      USERS = await loadUserData();

      // Auto-login if saved
      const saved = localStorage.getItem('currentUser');
      if (saved && USERS[saved]) {
        // show overlay (quick) then show dashboard
        showLoadingOverlay();
        setTimeout(async () => {
          hideLoadingOverlayInstant();
          showDashboard(USERS[saved], saved);
        }, 400); // short delay for UX
      }
    });

    // Login handler
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      loginMessage.style.display = 'none';
      const policyNumber = document.getElementById('policyNumber').value.trim();
      const password = document.getElementById('password').value;

      // re-sync user data before authenticating (simulate sync)
      USERS = await loadUserData();

      if (!policyNumber || !password) {
        loginMessage.className = 'message error';
        loginMessage.textContent = 'Please enter both policy number and password.';
        loginMessage.style.display = 'block';
        return;
      }

      if (USERS[policyNumber] && USERS[policyNumber].password === password) {
        // Good credentials -> show loading overlay for exactly 5 seconds, then show dashboard
        showLoadingOverlay();
        setTimeout(() => {
          // store current
          localStorage.setItem('currentUser', policyNumber);
          hideLoadingOverlayInstant(); // requested: overlay disappear instantly
          showDashboard(USERS[policyNumber], policyNumber);
        }, 5000);
      } else {
        loginMessage.className = 'message error';
        loginMessage.textContent = 'Invalid policy number or password';
        loginMessage.style.display = 'block';
      }
    });

    // Show/hide loading overlay
    function showLoadingOverlay(){
      loadingOverlay.style.display = 'flex';
      loadingOverlay.setAttribute('aria-hidden','false');
    }
    function hideLoadingOverlayInstant(){
      loadingOverlay.style.display = 'none';
      loadingOverlay.setAttribute('aria-hidden','true');
    }

    // Show dashboard (with fade-in)
    function showDashboard(user, key){
      currentUserKey = key || user.policy;
      // hide login area
      document.getElementById('loginArea').style.display = 'none';

      // populate
      document.getElementById('userAvatar').textContent = user.name.split(' ').map(n => n[0]).join('').substring(0,2);
      document.getElementById('userName').textContent = user.name;
      document.getElementById('userPolicy').textContent = `Policy Number: ${user.policy}`;

      document.getElementById('infoClaim').textContent = user.claim;
      // format date safely; if invalid date fallback to raw string
      let eff = new Date(user.effective);
      document.getElementById('infoEffective').textContent = isNaN(eff) ? user.effective : eff.toLocaleDateString();
      document.getElementById('infoCoverage').textContent = user.coverage;
      document.getElementById('infoLimit').textContent = `RM ${user.limit}`;
      document.getElementById('infoPremium').textContent = `RM ${user.premium} — Overdue`;
      document.getElementById('infoRefund').textContent = `RM ${user.refund} — Incoming`;
      document.getElementById('infoItem').textContent = user.item;
      document.getElementById('infoLogistics').textContent = user.logistics;
      document.getElementById('infoTracking').textContent = user.tracking;

      // prefill refund modal fields
      document.getElementById('refundName').value = user.name;
      document.getElementById('refundPolicy').value = user.policy;

      // show dashboard container and animate
      dashboardContainer.style.display = 'block';
      dashboardContainer.setAttribute('aria-hidden','false');
      // small timeout to allow layout then add show class for transition
      setTimeout(() => dashboardContainer.classList.add('show'), 50);
    }

    // Logout
    logoutBtn.addEventListener('click', () => {
      localStorage.removeItem('currentUser');
      currentUserKey = null;
      dashboardContainer.classList.remove('show');
      // hide dashboard instantly then show login area
      setTimeout(() => {
        dashboardContainer.style.display = 'none';
        document.getElementById('loginArea').style.display = 'block';
        // reset login form
        loginForm.reset();
      }, 200);
    });

    // Open refund modal
    openRefundBtn.addEventListener('click', () => {
      // show overlay
      refundModalOverlay.classList.add('show');
      refundModalOverlay.setAttribute('aria-hidden','false');
      // show modal inner fade-in
      const modal = refundModalOverlay.querySelector('.modal');
      modal.style.opacity = 0;
      modal.classList.add('fade-in');
      setTimeout(() => modal.classList.add('show'), 50);
      // reset messages
      refundMessage.style.display = 'none';
    });

    // Close refund modal functions
    function closeRefundModal(){
      // hide fade class then hide overlay after transition
      const modal = refundModalOverlay.querySelector('.modal');
      modal.classList.remove('show');
      // remove overlay quickly after transition time (.5s)
      setTimeout(() => {
        refundModalOverlay.classList.remove('show');
        refundModalOverlay.setAttribute('aria-hidden','true');
      }, 300);
    }
    closeRefundBtn.addEventListener('click', closeRefundModal);
    cancelRefundBtn.addEventListener('click', closeRefundModal);
    refundModalOverlay.addEventListener('click', (e) => {
      if (e.target === refundModalOverlay) closeRefundModal();
    });

    // Refund form submit
    refundForm.addEventListener('submit', (e) => {
      e.preventDefault();
      refundMessage.style.display = 'none';

      // Simple validation
      const email = document.getElementById('refundEmail').value.trim();
      const phone = document.getElementById('refundPhone').value.trim();
      const amount = document.getElementById('refundAmount').value;
      const reason = document.getElementById('refundReason').value.trim();
      const fileInput = document.getElementById('refundDocuments');

      if (!email || !phone || !amount || !reason || fileInput.files.length === 0) {
        refundMessage.className = 'message error';
        refundMessage.textContent = 'Please fill all required fields and upload an ID document.';
        refundMessage.style.display = 'block';
        return;
      }

      // Disable submit
      const submitBtn = document.getElementById('refundSubmitBtn');
      const originalText = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

      // Simulate server process + pretend to send file
      setTimeout(() => {
        refundMessage.className = 'message success';
        refundMessage.textContent = 'Thank you! Your refund request has been submitted successfully. Our team will contact you via email shortly.';
        refundMessage.style.display = 'block';

        // reset form fields (keep name & policy)
        document.getElementById('refundEmail').value = '';
        document.getElementById('refundPhone').value = '';
        document.getElementById('refundAmount').value = '';
        document.getElementById('refundReason').value = '';
        document.getElementById('refundDocuments').value = '';

        // restore submit button
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;

        // Optionally close modal after a short delay
        setTimeout(closeRefundModal, 1500);
      }, 2000);
    });

    // Accessibility: close modal with Esc
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && refundModalOverlay.classList.contains('show')) {
        closeRefundModal();
      }
    });

    // If you want to expose USERS in console for debugging:
    window._MYTAKAFUL_USERS = () => USERS;

  </script>
</body>
</html>